<html>
<head>
<title>Latest Kiting Weather for Wellington</title>
<script src="http://ajax.googleapis.com/ajax/libs/jquery/1.3.2/jquery.min.js" type="text/javascript"></script>
<script type="text/javascript">
//<![CDATA[

function get_ago_string(obsTime) {
  var d = new Date();
  var now = d.getTime()/1000.0;
  if (obsTime > now) {
    // Observation happened in future
    return false;
  }
  var diff = now - obsTime;

  if (diff < 60) {
    return parseInt(diff)+' seconds ago';
  } else if (diff < 60*60) {
    return parseInt(diff/60)+' minutes ago';
  } else if (diff < 60*60*24) {
    return parseInt(diff/(60*60))+' hours ago';
  } else if (diff < 60*60*24*365.25) {
    return parseInt(diff/(60*60*24))+' days ago';
  } else {
    return parseInt(diff/(60*60*24*365.25))+' years ago';
  }
}

$(document).ready(function() {
    // Show loading indicator
    $('tbody#tablebody').html('<tr><td colspan="5"><strong>Loading data...</strong></td></tr>');
    
    $.getJSON("http://localhost:8888/kiting/data.json",
        function(data){
            // if data loaded, empty the table ready for values
            $('tbody#tablebody').html('');
            // loop through each site in turn
            $.each(data, function(i,item){
                var site = item['name'];
                var windSpeed = item['reading']['windSpeed'];
                var windDir = item['reading']['windDir'];
                var windCardinal = item['reading']['windCardinal'];
                var obsTime = item['reading']['obsTime'];
                var obsTimeFormatted = item['reading']['obsTimeFormatted'];
                var agoString = get_ago_string(obsTime);
                var link = item['link'];
                var htmlStr = '<tr><td>'+site+'</td><td>'+windSpeed+'</td><td>'+windDir+' ('+windCardinal+')</td><td>'+obsTimeFormatted+'</td><td>'+agoString+'</td><td><a href="'+link+'">Link</a></td></tr>';
                $('tbody#tablebody').html($('tbody#tablebody').html()+htmlStr );

            });
    });
    
});
//]]>
</script>
</head>
<body>

<table border="1">
 <thead>
  <tr>
   <th>Location</th>
   <th>Wind Speed (knots)</th>
   <th>Wind Direction (degrees)</th>
   <th>Observation Time</th>
   <th>Time Ago</th>
   <th>Source</th>
  </tr>
 </thead>
 <tbody id="tablebody">

 </tbody>
</table>

</body>
</html>